# ๐ฏ Convolutional Optimizer for Neural Networks

**ะะฐััะพะผะฝัะน ะพะฟัะธะผะธะทะฐัะพั, ะบะพัะพััะน ัะณะปะฐะถะธะฒะฐะตั ะณัะฐะดะธะตะฝัั ัะฒัััะบะพะน ะฟะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธะตะผ ะฒะตัะพะฒ.**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)](https://pytorch.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะดะตั](#-ะธะดะตั)
- [ะะตะทัะปััะฐัั](#-ัะตะทัะปััะฐัั)
- [ะฃััะฐะฝะพะฒะบะฐ](#-ัััะฐะฝะพะฒะบะฐ)
- [ะัะฟะพะปัะทะพะฒะฐะฝะธะต](#-ะธัะฟะพะปัะทะพะฒะฐะฝะธะต)
- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะญะบัะฟะตัะธะผะตะฝัั](#-ัะบัะฟะตัะธะผะตะฝัั)
- [ะัะพะดะตะปะฐะฝะฝะฐั ัะฐะฑะพัะฐ](#-ะฟัะพะดะตะปะฐะฝะฝะฐั-ัะฐะฑะพัะฐ)

---

## ๐ก ะะดะตั

ะกัะฐะฝะดะฐััะฝัะต ะพะฟัะธะผะธะทะฐัะพัั ะธัะฟะพะปัะทััั "ััััะต" ะณัะฐะดะธะตะฝัั, ะบะพัะพััะต ะผะพะณัั ะฑััั ะทะฐััะผะปะตะฝั (ะพัะพะฑะตะฝะฝะพ ะฟัะธ ะผะฐะปะตะฝัะบะธั ะฑะฐััะฐั). **ะะฐั ะฟะพะดัะพะด**: ัะณะปะฐะดะธัั ะณัะฐะดะธะตะฝัั ัะฒัััะบะพะน ะฟะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธะตะผ ะฒะตัะพะฒ.

```
ะกัะฐะฝะดะฐััะฝัะน SGD:     ฮธ_{k+1} = ฮธ_k - lr * โL(ฮธ_k)
ะะฐั ะพะฟัะธะผะธะทะฐัะพั:     ฮธ_{k+1} = ฮธ_k - lr * (W โ โL(ฮธ_k))
                                        โ
                              ะพะฑััะฐะตะผะพะต ัะดัะพ ัะฒัััะบะธ
```

**ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ:**
- ๐ ะฏะดัะพ ัะฒัััะบะธ `W` **ะพะฑััะฐะตััั** ะฒะผะตััะต ั ัะตััั
- ๐ 2D ัะฒัััะบะฐ ะดะปั ะผะฐััะธัะฝัั ะณัะฐะดะธะตะฝัะพะฒ (Linear, Conv2d)
- ๐ ะะตััะธะบะฐ: ัะพััะฐะฝะตะฝะธะต ะฝะฐะฟัะฐะฒะปะตะฝะธั + ัะณะปะฐะถะธะฒะฐะฝะธะต ััะผะฐ
- โก ะัะพะฑะตะฝะฝะพ ัััะตะบัะธะฒะตะฝ ะฟัะธ **ะฒััะพะบะพะผ ััะผะต** ะฒ ะณัะฐะดะธะตะฝัะฐั

---

## ๐ ะะตะทัะปััะฐัั

### ะกััะตัั-ัะตัั: batch_size=8, 15% label noise

ะ ััะปะพะฒะธัั ะฒััะพะบะพะณะพ ััะผะฐ ะฝะฐัะธ ะพะฟัะธะผะธะทะฐัะพัั **ะฟัะตะฒะพััะพะดัั** ััะฐะฝะดะฐััะฝัะต:

![ะกัะฐะฒะฝะตะฝะธะต ะพะฟัะธะผะธะทะฐัะพัะพะฒ ะฟัะธ ะฒััะพะบะพะผ ััะผะต](noisy_comparison.png)

| ะะฟัะธะผะธะทะฐัะพั | Best Accuracy | Final Accuracy | Stability (โ ะปัััะต) |
|-------------|---------------|----------------|---------------------|
| SGD | 89.3% | 76.2% | 0.34 |
| Adam | 91.0% | 80.2% | 0.37 |
| **ConvSGD v1** | **92.7%** ๐ | 79.7% | 0.65 |
| **ConvSGD v2** | 91.5% | **82.5%** | **0.21** ๐ |

### Ablation: ะฒะปะธัะฝะธะต ัะฐะทะผะตัะฐ ะฑะฐััะฐ

![ะะปะธัะฝะธะต ัะฐะทะผะตัะฐ ะฑะฐััะฐ](batch_size_ablation.png)

| Batch Size | SGD | ConvSGD v2 | ะะฐะทะฝะธัะฐ |
|------------|-----|------------|---------|
| **8** | 88.4% | **89.8%** | **+1.4%** โ |
| 16 | 89.2% | 88.4% | -0.8% |
| 32 | 90.8% | 85.0% | -5.8% |
| 64 | 90.6% | 62.0% | -28.6% |

**ะัะฒะพะด:** ะกะณะปะฐะถะธะฒะฐะฝะธะต ะณัะฐะดะธะตะฝัะพะฒ ัััะตะบัะธะฒะฝะพ ะฟัะธ ะผะฐะปะตะฝัะบะธั ะฑะฐััะฐั (โค16), ะบะพะณะดะฐ ะณัะฐะดะธะตะฝัั ะทะฐััะผะปะตะฝั.

### ะญะฒะพะปััะธั ัะดัะฐ

ะฏะดัะพ ะพะฑััะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ โ ัะตะฝััะฐะปัะฝัะน ัะปะตะผะตะฝั ััะธะปะธะฒะฐะตััั:

```
ะะฐัะฐะปัะฝะพะต:  [0.20, 0.20, 0.20, 0.20, 0.20]  (ัะฐะฒะฝะพะผะตัะฝะพะต)
ะคะธะฝะฐะปัะฝะพะต:  [0.05, 0.05, 0.79, 0.05, 0.05]  (ัะพะบัั ะฝะฐ ัะตะฝััะต)
```
---

## ๐ ะฃััะฐะฝะพะฒะบะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐะฝะธะต
git clone https://github.com/your-username/ConvolutionalOptimizer.git
cd ConvolutionalOptimizer

# ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
python -m venv venv

# ะะบัะธะฒะฐัะธั (Windows)
.\venv\Scripts\Activate.ps1

# ะะบัะธะฒะฐัะธั (Linux/Mac)
source venv/bin/activate

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r requirements.txt
```

---

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะัััััะน ััะฐัั

```python
from optimizers import ConvolutionalSGDv2
import torch.nn as nn

model = nn.Sequential(
    nn.Linear(784, 128),
    nn.ReLU(),
    nn.Linear(128, 10)
)

# ะะฐั ะพะฟัะธะผะธะทะฐัะพั
optimizer = ConvolutionalSGDv2(
    model.parameters(),
    lr=0.01,
    momentum=0.9,
    kernel_size=5,      # ะะฐะทะผะตั ัะดัะฐ ัะฒัััะบะธ
    kernel_lr=0.005     # Learning rate ะดะปั ะพะฑััะตะฝะธั ัะดัะฐ
)

# ะะฑััะตะฝะธะต
for data, target in dataloader:
    optimizer.zero_grad()
    loss = criterion(model(data), target)
    loss.backward()
    
    # ะะปั ะฐะดะฐะฟัะฐัะธะธ ัะดัะฐ ะฟะตัะตะดะฐัะผ closure
    def closure():
        return criterion(model(data), target)
    optimizer.step(closure)
```

### ะะพัััะฟะฝัะต ะพะฟัะธะผะธะทะฐัะพัั

| ะะปะฐัั | ะะฟะธัะฐะฝะธะต | ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั |
|-------|----------|-------------------|
| `ConvolutionalSGD` | ะะฐะทะพะฒัะน ั ัะฒัะธััะธัะตัะบะพะน ะฐะดะฐะฟัะฐัะธะตะน ัะดัะฐ | ะัะพัััะต ัะบัะฟะตัะธะผะตะฝัั |
| `LocalLossConvSGD` | ะะพะบะฐะปัะฝัะต loss ะดะปั ะบะฐะถะดะพะณะพ ะฟะฐัะฐะผะตััะฐ | ะััะปะตะดะพะฒะฐะฝะธั |
| `ConvolutionalSGDv2` | 2D ัะฒัััะบะฐ + ะพะฑััะฐะตะผะพะต ัะดัะพ ัะตัะตะท backprop | **ะะตะบะพะผะตะฝะดัะตััั** |

### ะะฐะฟััะบ ะดะตะผะพ

```bash
# ะกัะฐะฝะดะฐััะฝะพะต ััะฐะฒะฝะตะฝะธะต ะฝะฐ MNIST
python demo.py

# ะกััะตัั-ัะตัั (ะผะฐะปะตะฝัะบะธะน ะฑะฐัั + ััะผ)
python demo_noisy.py
```

---

## ๐ ะััะธัะตะบัััะฐ

```
ConvolutionalOptimizer/
โโโ optimizers/
โ   โโโ __init__.py
โ   โโโ conv_sgd.py          # ะะฐะทะพะฒัะน ConvolutionalSGD
โ   โโโ conv_sgd_v2.py       # ะัะพะดะฒะธะฝัััะน ั 2D ัะฒัััะบะพะน
โ   โโโ local_loss_sgd.py    # ะก ะปะพะบะฐะปัะฝัะผะธ loss
โโโ models/
โ   โโโ __init__.py
โ   โโโ test_networks.py     # SimpleNet, DeepNet, IllConditionedNet
โโโ demo.py                   # ะกัะฐะฒะฝะตะฝะธะต ะฝะฐ ัะธัััั ะดะฐะฝะฝัั
โโโ demo_noisy.py             # ะกััะตัั-ัะตัั
โโโ requirements.txt
โโโ README.md
```

---

## ๐ฌ ะญะบัะฟะตัะธะผะตะฝัั

### ะญะบัะฟะตัะธะผะตะฝั 1: ะกัะฐะฝะดะฐััะฝัะต ััะปะพะฒะธั (MNIST)

```bash
python demo.py
```

- ะะฐัะฐัะตั: MNIST (5000 train, 1000 test)
- Batch size: 64
- Epochs: 20

**ะะตะทัะปััะฐั:** ะะฐ ัะธัััั ะดะฐะฝะฝัั ั ะฑะพะปััะธะผ ะฑะฐััะตะผ Adam ะปะธะดะธััะตั.

### ะญะบัะฟะตัะธะผะตะฝั 2: ะกััะตัั-ัะตัั

```bash
python demo_noisy.py
```

ะฃัะปะพะฒะธั:
- `batch_size=8` โ ะฒััะพะบะธะน ััะผ ะฒ ะณัะฐะดะธะตะฝัะฐั
- `noise_rate=15%` โ 15% ะฝะตะฟัะฐะฒะธะปัะฝัั ะผะตัะพะบ

**ะะตะทัะปััะฐั:** ConvSGD v1 ะดะพััะธะณะฐะตั **92.7% accuracy** (vs 91.0% Adam) ๐

---

## ๐ ะัะพะดะตะปะฐะฝะฝะฐั ัะฐะฑะพัะฐ

### ะญัะฐะฟ 1: ะะฐะทะพะฒะฐั ัะตะฐะปะธะทะฐัะธั

1. **ConvolutionalSGD** (`conv_sgd.py`)
   - 1D ัะฒัััะบะฐ ะณัะฐะดะธะตะฝัะพะฒ
   - ะญะฒัะธััะธัะตัะบะฐั ะฐะดะฐะฟัะฐัะธั ัะดัะฐ ะฝะฐ ะพัะฝะพะฒะต ะธะทะผะตะฝะตะฝะธั loss
   - ะะพะผะตะฝััะผ ะบะฐะบ ะฒ ััะฐะฝะดะฐััะฝะพะผ SGD

2. **LocalLossConvSGD** (`local_loss_sgd.py`)
   - ะัะดะตะปัะฝะพะต ัะดัะพ ะดะปั ะบะฐะถะดะพะณะพ ะฟะฐัะฐะผะตััะฐ
   - ะะพะบะฐะปัะฝัะน loss: ะบะพัะธะฝััะฝะพะต ััะพะดััะฒะพ + ัััะฐั ะทะฐ ะฒะฐัะธะฐัะธั
   - ะงะธัะปะตะฝะฝะพะต ะดะธััะตัะตะฝัะธัะพะฒะฐะฝะธะต ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ัะดะตั

3. **ะขะตััะพะฒัะต ะผะพะดะตะปะธ** (`test_networks.py`)
   - SimpleNet: 3-ัะปะพะนะฝะฐั MLP
   - DeepNet: 6+ ัะปะพัะฒ
   - IllConditionedNet: ัะฐะทะฝัะต ะผะฐัััะฐะฑั ะฒะตัะพะฒ
   - ConvNet, ResNet: ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะฐััะธัะตะบัััั

### ะญัะฐะฟ 2: ะฃะปัััะตะฝะธั (v2)

4. **ConvolutionalSGDv2** (`conv_sgd_v2.py`)
   - **2D ัะฒัััะบะฐ** ะดะปั ะผะฐััะธัะฝัั ะณัะฐะดะธะตะฝัะพะฒ (Linear, Conv2d)
   - **ะะฑััะฐะตะผะพะต ัะดัะพ ัะตัะตะท backprop** (ะฝะต ัะฒัะธััะธะบะฐ)
   - **ะฃะปัััะตะฝะฝะฐั ะผะตััะธะบะฐ**:
     - ะกะพััะฐะฝะตะฝะธะต ะฝะฐะฟัะฐะฒะปะตะฝะธั (cosine similarity)
     - ะะปะธะทะพััั ะบ "ัะธััะพะผั" ัะธะณะฝะฐะปั (EMA ะณัะฐะดะธะตะฝัะพะฒ)
     - ะกะณะปะฐะถะธะฒะฐะฝะธะต (ะผะธะฝะธะผะธะทะฐัะธั ะฒะฐัะธะฐัะธะธ)
   - **ะัะตะฝะบะฐ SNR** (Signal-to-Noise Ratio) ะณัะฐะดะธะตะฝัะพะฒ
   - ะะฐัััะพะฒะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธั ัะดัะฐ

### ะญัะฐะฟ 3: ะญะบัะฟะตัะธะผะตะฝัั

5. **ะกััะตัั-ัะตัั** (`demo_noisy.py`)
   - ะะฐะปะตะฝัะบะธะน batch_size (8) ะดะปั ััะธะปะตะฝะธั ััะผะฐ
   - Label noise (15%) ะดะปั ะธะผะธัะฐัะธะธ ัะตะฐะปัะฝัั ััะปะพะฒะธะน
   - Ablation study: ะฒะปะธัะฝะธะต ัะฐะทะผะตัะฐ ะฑะฐััะฐ

### ะะปััะตะฒัะต ะฝะฐัะพะดะบะธ

| ะฃัะปะพะฒะธั | ะัััะธะน ะพะฟัะธะผะธะทะฐัะพั | ะะพัะตะผั |
|---------|-------------------|--------|
| ะงะธัััะต ะดะฐะฝะฝัะต, batch=64 | Adam | ะัะฐะดะธะตะฝัั ะธ ัะฐะบ ัะธัััะต |
| ะจัะผ, batch=8 | **ConvSGD v1** | ะกะณะปะฐะถะธะฒะฐะฝะธะต ัะฑะธัะฐะตั ััะผ |
| ะกัะฐะฑะธะปัะฝะพััั | **ConvSGD v2** | ะกะฐะผัะน ะฝะธะทะบะธะน std(grad_norm) |

---

## ๐ง ะขะตะพัะตัะธัะตัะบะฐั ะพัะฝะพะฒะฐ

### ะคะพัะผัะปะฐ ะพะฑะฝะพะฒะปะตะฝะธั ะฒะตัะพะฒ

$$\theta_{t+1} = \theta_t - \eta \cdot (W * \nabla L(\theta_t))$$

ะณะดะต $W$ โ ะพะฑััะฐะตะผะพะต ัะดัะพ ัะฒัััะบะธ.

### Loss ะดะปั ะพะฑััะตะฝะธั ัะดัะฐ

$$\mathcal{L}_W = \underbrace{-\cos(\nabla L, W * \nabla L)}_{\text{ัะพััะฐะฝะตะฝะธะต ะฝะฐะฟัะฐะฒะปะตะฝะธั}} + \lambda \cdot \underbrace{\text{Var}(W * \nabla L)}_{\text{ัะณะปะฐะถะธะฒะฐะฝะธะต}}$$

### ะัะตะฝะบะฐ SNR ะณัะฐะดะธะตะฝัะฐ

Signal-to-Noise Ratio ะพัะตะฝะธะฒะฐะตััั ัะตัะตะท EMA:
- **Signal** = ัะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะต ัะบะพะปัะทััะตะต ััะตะดะฝะตะต ะณัะฐะดะธะตะฝัะพะฒ
- **Noise** = ะพัะบะปะพะฝะตะฝะธะต ัะตะบััะตะณะพ ะณัะฐะดะธะตะฝัะฐ ะพั ัะธะณะฝะฐะปะฐ

---

## ๐ ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

### โ ะะตะบะพะผะตะฝะดัะตััั:
- ะะฐะปะตะฝัะบะธะต ะฑะฐััะธ (โค16)
- ะจัะผะฝัะต ะดะฐะฝะฝัะต / noisy labels
- ะะตััะฐะฑะธะปัะฝะพะต ะพะฑััะตะฝะธะต
- Adversarial training

### โ ะะต ัะตะบะพะผะตะฝะดัะตััั:
- ะะพะปััะธะต ะฑะฐััะธ (โฅ64)
- ะงะธัััะต ะดะฐะฝะฝัะต ะฑะตะท ััะผะฐ
- ะะพะณะดะฐ ัะบะพัะพััั ะบัะธัะธัะฝะฐ (v2 ะผะตะดะปะตะฝะฝะตะต)

---

## ๐ ะะฐะฒะธัะธะผะพััะธ

```
torch>=2.0.0
torchvision>=0.15.0
matplotlib>=3.7.0
numpy>=1.24.0
```

---

## ๐ ะะธัะตะฝะทะธั

MIT License

---
